

## grpc协议栈

![image-20241017195354460](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241017195354460.png)

## grpc网络模型

### 同步模型：

![image-20241017195445409](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241017195445409.png)

### 异步模型

![image-20241017200139112](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241017200139112.png)

![image-20241018073656965](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018073656965.png)

**async_test2.cc文件的处理方案**

![image-20241018074623661](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018074623661.png)





## grpc for c++使用案例

![image-20241018085149047](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018085149047.png)

![image-20241018085203331](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018085203331.png)

![image-20241018085241489](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018085241489.png)

![image-20241018085304347](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018085304347.png)

![image-20241018085441696](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018085441696.png)

![image-20241018085518302](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018085518302.png)

 

![image-20241018085902698](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018085902698.png)

  

客户端：

![image-20241018090110018](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018090110018.png)

![image-20241018090120707](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018090120707.png) 

![image-20241018090142207](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018090142207.png)

![image-20241018090215537](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018090215537.png)

## 同步多函数多类调用

![image-20241018090516469](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018090516469.png)

proto文件：

新增如下

![image-20241018090655560](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018090655560.png)

### **服务端**

![image-20241018090725832](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018090725832.png)

### 

![image-20241018090737953](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018090737953.png)



![image-20241018090846078](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018090846078.png)

完整代码

![image-20241018090922230](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018090922230.png)

![image-20241018090951271](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018090951271.png)

main函数：

![image-20241018091009449](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018091009449.png)

### 客户端

![image-20241018091147789](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018091147789.png)

![image-20241018091218900](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018091218900.png)

![image-20241018091230690](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018091230690.png)

![image-20241018091300241](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018091300241.png)

![image-20241018091347134](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018091347134.png)



## 异步多函数多类调用

 

![image-20241018092747013](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018092747013.png)





## 性能测试

![image-20241018094823316](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018094823316.png)

![image-20241018095122444](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018095122444.png)

### 结论：

![image-20241018100818545](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018100818545.png)

![image-20241018100841136](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018100841136.png)

   

## grpc总结：

![image-20241018101813871](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018101813871.png)

![image-20241018101833577](4.4.2%E5%9F%BA%E4%BA%8Ehttp2%20%E7%9A%84gRPC%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE.assets/image-20241018101833577.png)